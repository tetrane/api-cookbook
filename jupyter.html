<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Displaying data nicely in Jupyter notebooks - REVEN API Cookbook</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />
        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
	<link rel="stylesheet" href="bulma.css">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="bulma.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="server.html"><strong aria-hidden="true">2.</strong> Connecting to a server</a></li><li class="chapter-item expanded "><a href="iterating.html"><strong aria-hidden="true">3.</strong> Manipulating transitions and contexts</a></li><li class="chapter-item expanded "><a href="context-read.html"><strong aria-hidden="true">4.</strong> Reading values from registers or memory</a></li><li class="chapter-item expanded "><a href="start-end.html"><strong aria-hidden="true">5.</strong> Moving to the beginning, end of a function</a></li><li class="chapter-item expanded "><a href="search-calls.html"><strong aria-hidden="true">6.</strong> Searching for function calls</a></li><li class="chapter-item expanded "><a href="crash.html"><strong aria-hidden="true">7.</strong> Looking for a crash</a></li><li class="chapter-item expanded "><a href="memhist.html"><strong aria-hidden="true">8.</strong> Finding out when a memory location is accessed</a></li><li class="chapter-item expanded "><a href="call-values.html"><strong aria-hidden="true">9.</strong> Displaying the value of arguments and return value of a call</a></li><li class="chapter-item expanded "><a href="search-values.html"><strong aria-hidden="true">10.</strong> Searching for values in memory</a></li><li class="chapter-item expanded "><a href="listing-ossi.html"><strong aria-hidden="true">11.</strong> Listing the processes, binaries in the trace</a></li><li class="chapter-item expanded "><a href="filters.html"><strong aria-hidden="true">12.</strong> Focusing on a portion of the trace</a></li><li class="chapter-item expanded "><a href="taint.html"><strong aria-hidden="true">13.</strong> Following the dataflow</a></li><li class="chapter-item expanded "><a href="jupyter.html" class="active"><strong aria-hidden="true">14.</strong> Displaying data nicely in Jupyter notebooks</a></li><li class="chapter-item expanded "><a href="tabular.html"><strong aria-hidden="true">15.</strong> Exporting tabular data to work with reporting tools</a></li><li class="chapter-item expanded "><a href="bookmarks.html"><strong aria-hidden="true">16.</strong> Managing bookmarks</a></li><li class="chapter-item expanded "><a href="instruction-semantics.html"><strong aria-hidden="true">17.</strong> Finding more about the semantics of an instruction</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">REVEN API Cookbook</h1>

                    <div class="right-buttons">
                        <a href="https://www.tetrane.com" title="Go to main site" aria-label="Go to main site">
                            <img src=".//static/logo.png" alt="Tetrane logo" style="width:28px;height:28px;vertical-align:middle"></i>
                        </a>
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="displaying-data-nicely-in-jupyter-notebooks"><a class="header" href="#displaying-data-nicely-in-jupyter-notebooks">Displaying data nicely in Jupyter notebooks</a></h1>
<h2 id="detecting-if-the-script-is-executed-in-a-notebook-or-not"><a class="header" href="#detecting-if-the-script-is-executed-in-a-notebook-or-not">Detecting if the script is executed in a notebook or not</a></h2>
<pre><code class="language-py">def in_notebook():
    &quot;&quot;&quot;
    Detect if we are currently running a Jupyter notebook.

    This is used to display rendered results inline in Jupyter when we are
    executing in the context of a Jupyter notebook, or to display raw results
    on the standard output when we are executing in the context of a script.
    &quot;&quot;&quot;
    try:
        from IPython import get_ipython  # type: ignore

        if get_ipython() is None or (&quot;IPKernelApp&quot; not in get_ipython().config):
            return False
    except ImportError:
        return False
    return True
</code></pre>
<h2 id="displaying-a-transition-address-as-a-synchronization-link"><a class="header" href="#displaying-a-transition-address-as-a-synchronization-link">Displaying a transition, address as a synchronization link</a></h2>
<div class="bulma">
<div class="field is-grouped is-grouped-multiline">
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">REVEN</span>
        <span class="tag is-info">v2.5.0</span>
    </div>
</div>
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">Environment</span>
        <span class="tag is-info">Jupyter</span>
    </div>
</div>
</div>
</div>
<pre><code class="language-py">display(tr)
display(address)
display(bookmark)
</code></pre>
<p>Sample output:</p>
<p><img src="img/jupyter_display.png" alt="Synchronization links" /></p>
<h2 id="displaying-in-tables"><a class="header" href="#displaying-in-tables">Displaying in tables</a></h2>
<pre><code class="language-py"># helper functions to output html tables
def table_line(cells):
    line = &quot;&quot;
    for cell in cells:
        line += &quot;&lt;td&gt;{}&lt;/td&gt;&quot;.format(cell)
    return &quot;&lt;tr&gt;{}&lt;/tr&gt;&quot;.format(line)

def display_table(title, headers, html_lines):
    header_line = &quot;&quot;
    for header in headers:
        header_line += &quot;&lt;th&gt;{}&lt;/th&gt;&quot;.format(header)
    header_line = &quot;&lt;tr&gt;{}&lt;/tr&gt;&quot;.format(header_line)
    display(HTML(&quot;&quot;&quot;&lt;h2&gt;{}&lt;/h2&gt;&lt;table&gt;{} {}&lt;/table&gt;&quot;&quot;&quot;.format(title, header_line, html_lines)))
</code></pre>
<h2 id="pretty-printing"><a class="header" href="#pretty-printing">Pretty printing</a></h2>
<h3 id="basics"><a class="header" href="#basics">Basics</a></h3>
<div class="bulma">
<div class="field is-grouped is-grouped-multiline">
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">REVEN</span>
        <span class="tag is-info">v2.7.0</span>
    </div>
</div>
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">Environment</span>
        <span class="tag is-info">Jupyter</span>
    </div>
</div>
</div>
</div>
<pre><code class="language-py">from IPython.display import HTML, display
display(HTML(f&quot;&lt;strong&gt;{tr.format_as_html()}&lt;/strong&gt;&quot;))
</code></pre>
<p>Sample output:</p>
<p><img src="img/jupyter_basic_pretty.png" alt="Transition displayed strong" /></p>
<h3 id="transition"><a class="header" href="#transition">Transition</a></h3>
<div class="bulma">
<div class="field is-grouped is-grouped-multiline">
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">REVEN</span>
        <span class="tag is-info">v2.5.0</span>
    </div>
</div>
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">Environment</span>
        <span class="tag is-info">Jupyter</span>
    </div>
</div>
</div>
</div>
<pre><code class="language-py">import reven2
from IPython.display import HTML, display
import re
import itertools
import html

all_regs = {}
for reg in reven2.arch.helpers.x64_registers():
    all_regs[reg.name] = reg

def tokenize_string(string):
    return re.split(&quot; |dword|ptr|\\[|\\]|\\+|\\*|,&quot;, string)

def tokenize_instruction(transition):
    if transition.instruction is None:
        return []
    return tokenize_string(str(transition.instruction))

def get_pretty_print_tr(tr, show_context=False, show_symbol=False):
    output = &quot;&quot;
    if show_symbol:
        output += &quot;&lt;span&gt;{}&lt;/span&gt;&lt;br/&gt;&quot;.format(html.escape(str(tr.context_before().ossi.location())))

    output += tr._repr_html_()
    output += &quot; &lt;code&gt;{}&lt;/code&gt;&quot;.format(str(tr).split(&quot; &quot;, 1)[1])
    output += &quot;&lt;br/&gt;&quot;

    if not show_context:
        return '&lt;p style=&quot;font-family:monospace&quot; class=&quot;tex2jax_ignore&quot;&gt;' + output + &quot;&lt;/p&gt;&quot;

    instr_elements = tokenize_instruction(tr)
    done_already = []
    print_data = []
    for elem in instr_elements:
        if elem in done_already:
            continue
        done_already.append(elem)
        if elem in all_regs:
            before = tr.context_before().read(all_regs[elem])
            after = tr.context_after().read(all_regs[elem])
            if before == after or elem in [&quot;rip&quot;]:
                print_data.append(&quot;{} = {:x}&quot;.format(elem, before))
            else:
                print_data.append(&quot;{} = {:x} to {:x}&quot;.format(elem, before, after))

    output += &quot;, &quot;.join(print_data) + &quot;&lt;br/&gt;&quot;
    print_data = []

    max_items = 4
    accesses = list(itertools.islice(tr.memory_accesses(), max_items))
    for acc in accesses:
        elem = &quot;{}[{:#x}]:{}&quot;.format(&quot;R&quot; if acc.operation == reven2.memhist.MemoryAccessOperation.Read else &quot;W&quot;,
                                     acc.virtual_address.offset,
                                     acc.size)
        try:
            before = tr.context_before().read(acc.virtual_address, acc.size)
            after = tr.context_after().read(acc.virtual_address, acc.size)
            if before == after:
                print_data.append(&quot;{} = {:x}&quot;.format(elem, before))
            else:
                print_data.append(&quot;{} = {:x} to {:x}&quot;.format(elem, before, after))
        except:
            print_data.append(elem + &quot; = ?&quot;)

    if len(accesses) &gt; max_items:
        print_data.append(&quot;...&quot;)
    output += &quot;, &quot;.join(print_data)

    return '&lt;p style=&quot;font-family:monospace&quot; class=&quot;tex2jax_ignore&quot;&gt;' + output + &quot;&lt;/p&gt;&quot;

def pretty_print_tr(tr, show_context=False, show_symbol=False):
    display(HTML(get_pretty_print_tr(tr, show_context=show_context, show_symbol=show_symbol)))
</code></pre>
<p>Sample output:</p>
<p><img src="img/jupyter_pretty_tr.png" alt="Pretty transitions" /></p>
<h3 id="address--hexdump"><a class="header" href="#address--hexdump">Address / Hexdump</a></h3>
<div class="bulma">
<div class="field is-grouped is-grouped-multiline">
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">REVEN</span>
        <span class="tag is-info">v2.5.0</span>
    </div>
</div>
<div class="control">
    <div class="tags has-addons">
        <span class="tag is-dark">Environment</span>
        <span class="tag is-info">Jupyter</span>
    </div>
</div>
</div>
</div>
<p>Pretty print the content of a buffer at a specified address, in 0x10 increments.
If passed a register, it will be dereferenced.</p>
<pre><code class="language-py">import reven2
from reven2.address import LinearAddress  # shortcut when reading addresses
from IPython.display import HTML, display

def print_buffer(b, addr=0, col=16, highlights = []):
    style_highlight = '&lt;span style=&quot;background-color:yellow&quot;&gt;'
    style_highlight_off = '&lt;/span&gt;'
    output = '&lt;code style=&quot;background-color:white&quot;&gt;\n'

    prev_all_zeros = 0
    for i in range(int(len(b) / col)):

        total_sum = sum(b[i*col:(i+1)*col])
        for h in highlights:
            if h in range(i*col,col):
                total_sum = 0

        total_sum_next = sum(b[(i+1)*col:(i+2)*col])
        if total_sum == 0:
            prev_all_zeros += 1
        else:
            prev_all_zeros == 0
        if prev_all_zeros &gt; 0 and total_sum_next == 0 and len(b) &gt;= (i+2)*col:
            if prev_all_zeros == 1:
                output += &quot;...\n&quot;
            continue

        output += &quot;{:016x}:&quot;.format(i*col + addr)

        for j in range(col):
            offset = j + i*col

            if offset &gt;= len(b):
                break
            if j % 8 == 0:
                output += &quot; &quot;

            total_sum += b[offset]
            if offset in highlights:
                output += style_highlight
            output += &quot;{:02x}&quot;.format(b[offset])
            if offset in highlights:
                output += style_highlight_off
            output += &quot; &quot;

        output += &quot;- &quot;
        for j in range(col):
            offset = j + i*col
            if offset &gt;= len(b):
                break
            c = b[offset]

            if offset in highlights:
                output += style_highlight

            if c &gt;= 32 and c &lt;= 126:
                output += &quot;{}&quot;.format(chr(c))
            else:
                output += &quot;.&quot;

            if offset in highlights:
                output += style_highlight_off
        output += &quot;\n&quot;
    output += &quot;&lt;/code&gt;&quot;
    display(HTML(output))

def pretty_print_addr(ctx, address, size):
    if isinstance(address, reven2.arch.register.Register):
        address = ctx.read(address)
    if isinstance(address, int):
        address = LinearAddress(address)
    print_buffer(ctx.read(address, size), address.offset)
</code></pre>
<p>Sample output:</p>
<p><img src="img/jupyter_pretty_address.png" alt="Pretty addresses" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="taint.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="tabular.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="taint.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="tabular.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
